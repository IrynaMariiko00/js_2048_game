const t="idle",e="playing",s="lose",o=new class{constructor(e,s,o){this.board=e||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status=t,this.winCallback=s,this.loseCallback=o}updateBoard(){let t=document.querySelectorAll(".field-cell"),e=0;for(let s=0;s<this.board.length;s++)for(let o=0;o<this.board[s].length;o++){let r=t[e++],a=this.board[s][o],i=r.textContent;r.classList.remove(`field-cell--${i}`),0===a?r.textContent="":(r.classList.add(`field-cell--${a}`),r.textContent=a)}}findEmptyCell(){let t=[];for(let e=0;e<this.board.length;e++)for(let s=0;s<this.board.length;s++)0===this.board[e][s]&&t.push({row:e,col:s});return t[Math.floor(Math.random()*t.length)]}addRandomTile(){let t=this.findEmptyCell();t&&(0===this.score&&(this.board[t.row][t.col]=2),this.updateBoard())}addRandomCellAfterMoving(){let t=this.findEmptyCell();t&&(this.board[t.row][t.col]=.9>Math.random()?2:4,this.updateBoard())}createColumn(t){let e=[];for(let s=0;s<this.board.length;s++)0!==this.board[s][t]&&e.push(this.board[s][t]);return e}updateColumn(t,e){let s=!1;for(let o=0;o<this.board.length;o++)this.board[o][t]!==e[o]&&(this.board[o][t]=e[o],s=!0);return s}resetGameStart(){this.score=0,this.status=e,this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.addRandomTile(),this.addRandomTile()}updateBoardAfterMoving(){this.addRandomCellAfterMoving(),this.updateBoard(),this.getStatus()}moveHorizontal(t){for(let e=0;e<this.board.length;e++){let s=this.board[e].filter(t=>0!==t),o=[];for(let t=0;t<s.length;t++){let e=s[t];if(e===s[t+1]){let s=2*e;o.push(s),this.getScore(!0,s),t++}else o.push(e)}for(;o.length<this.board[e].length;)t(o);this.board[e]=o}}moveLeft(){this.moveHorizontal(t=>t.push(0)),this.updateBoardAfterMoving()}moveRight(){this.moveHorizontal(t=>t.unshift(0)),this.updateBoardAfterMoving()}moveUp(){for(let t=0;t<this.board.length;t++){let e=this.createColumn(t),s=Array(e.length).fill(!0);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&s[t]&&s[t+1]&&(e[t]*=2,e.splice(t+1,1),s[t]=!1,this.getScore(!0,e[t]));for(;e.length<this.board.length;)e.push(0);this.updateColumn(t,e)}this.updateBoardAfterMoving()}moveDown(){for(let t=0;t<this.board.length;t++){let e=this.createColumn(t),s=Array(e.length).fill(!0);for(let t=e.length-1;t>0;t--)e[t]===e[t-1]&&s[t]&&s[t-1]&&(e[t]*=2,e.splice(t-1,1),s[t]=!1,this.getScore(!0,e[t]));for(;e.length<this.board.length;)e.unshift(0);this.updateColumn(t,e)}this.updateBoardAfterMoving()}getState(){return this.board}getStatus(){if(0===this.score)return this.status=t,this.status;let o=!1,r=!1;for(let t=0;t<this.board.length;t++)for(let e=0;e<this.board[t].length;e++){let s=this.board[t][e];if(2048===s&&(o=!0),r)continue;if(0===s){r=!0;continue}let a=t<this.board.length-1&&s===this.board[t+1][e],i=e<this.board[t].length-1&&s===this.board[t][e+1];(a||i)&&(r=!0)}return o?(this.status="win",this.winCallback()):r?this.status=e:(this.status=s,this.loseCallback()),this.status}start(){this.resetGameStart()}restart(){this.resetGameStart()}}(null,function(){n.classList.remove("hidden")},function(){d.classList.remove("hidden")}),r=document.querySelector(".start"),a=document.querySelectorAll(".field-cell"),i=document.querySelector(".game-score"),l=document.querySelector(".best__score"),h=document.querySelector(".message-start"),n=document.querySelector(".message-win"),d=document.querySelector(".message-lose");function c(){d.classList.add("hidden")}function u(){n.classList.add("hidden")}function g(){let t=localStorage.getItem("highScore")||0;l.textContent=t}g(),o.getScore=function(t,e){if(t&&e>0){var s;this.score+=e,s=this.score,i.textContent=s,function(t){let e=localStorage.getItem("highScore");(!e||t>e)&&(localStorage.setItem("highScore",t),g())}(this.score)}},r.addEventListener("click",()=>{r.textContent="Restart",r.classList.remove("start"),r.classList.add("restart"),i.textContent="0",a.forEach(t=>{t.classList.remove("hidden")}),("win"===o.status||o.status===s)&&(u(),c()),o.start(),h.classList.add("hidden"),c(),u(),g()}),document.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":o.moveLeft();break;case"ArrowRight":o.moveRight();break;case"ArrowUp":o.moveUp();break;case"ArrowDown":o.moveDown()}});
//# sourceMappingURL=index.bc608c8e.js.map
